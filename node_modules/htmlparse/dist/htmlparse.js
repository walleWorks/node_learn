!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.htmlparse=t.htmlparse||{})}(this,function(t){"use strict";function e(t){for(var e=0,i=0,n=Object.keys(t).length;i<n;)e=i+M-n+1,void 0!==t[e]&&(t[t[e]]=e),++i}function i(t){return void 0!==L[t]?L[t]:void 0!==C[t]?C[t]:null}function n(t,e){var i=null;for(i in e)e[i]instanceof Function&&(t.prototype[i]=e[i])}function r(){return this.parseNodeList()}function s(){for(var t=this,e=[];;){if(t.isEOF()||t.peek(C.CTAG))break;var i=t.parseNode();e.push(i)}return e}function o(){var t={};this.expect(C.OTAG);var e=null;e=this.eat(C.NOT)?"!"+this.consume().value:this.consume().value,t.localName=e,t.nodeType=S.ELEMENT_NODE;var i=this.parseAttributes();return t.attributes=i,this.eat(C.SLASH)?(this.eat(C.CTAG)||console.log(this.current.value),t):(this.expect(C.CTAG),t.children=this.parseNodeContent(e),this.isEOF()||this.parseClosingNode(),t)}function u(t){for(var e=this,i=[];;){if(e.isEOF())break;if(e.peek(L.TextLiteral))i.push({localName:"text",nodeType:S.TEXT_NODE,value:e.current.value}),e.next();else{if(e.subsequent(C.SLASH)&&e.tokens[e.idx+2].value===t)break;i.push(e.parseNode())}}return i}function a(){this.expect(C.OTAG),this.expect(C.SLASH),this.next(),this.parseAttributes(),this.expect(C.CTAG)}function h(){for(var t=this,e=[];;){if(t.peek(C.CTAG)||t.peek(C.SLASH))break;var i={};i.nodeType=S.ATTRIBUTE_NODE,i.name=t.consume().value,t.eat(C.ASSIGN)&&(i.nodeValue=t.consume().value),e.push(i)}return e}var c=60,p=62,f=48,l=57,d=39,x=34,T=65,k=97,v=90,E=122,y=95,N=33,A=46,b=47,O=45,m=61,g={},L={},S={},C={},M=0;!function(t){t[t["="]=++M]="ASSIGN",t[t["<"]=++M]="OTAG",t[t[">"]=++M]="CTAG",t[t["/"]=++M]="SLASH",t[t["-"]=++M]="MINUS",t[t["!"]=++M]="NOT",e(C)}(C),function(t){t[t.TEXT_NODE=3]="TEXT_NODE",t[t.ELEMENT_NODE=1]="ELEMENT_NODE",t[t.COMMENT_NODE=8]="COMMENT_NODE",t[t.ATTRIBUTE_NODE=2]="ATTRIBUTE_NODE"}(S),function(t){t[t.area=++M]="AREA",t[t.base=++M]="BASE",t[t.col=++M]="COL",t[t.embed=++M]="EMBED",t[t.hr=++M]="HR",t[t.img=++M]="IMG",t[t.input=++M]="INPUT",t[t.link=++M]="LINK",t[t.menuitem=++M]="MENUITEM",t[t.meta=++M]="META",t[t.param=++M]="PARAM",t[t.source=++M]="SOURCE",t[t.track=++M]="TRACK",t[t.wbr=++M]="WBR"}(g),function(t){t[t.EOF=++M]="EOF",t[t.Identifier=++M]="Identifier",t[t.TextLiteral=++M]="TextLiteral",t[t.StringLiteral=++M]="StringLiteral",t[t.NumericLiteral=++M]="NumericLiteral"}(L);var I=function(){this.idx=0,this.tokens=[],this.src="",this.length=0};I.prototype.reset=function(){this.idx=-1,this.tokens=[]},I.prototype.lex=function(t){var e=this;this.reset(),this.src=t,this.length=t.length;for(var i=0;;){if((i=e.next())<=0)break;e.isBlank(i)||e.scanToken(i)}return this.pushEOF(),this.tokens},I.prototype.scanToken=function(t){return this.isPunctuator(t)&&t===c?void this.scanTagOpen():void this.scanText()},I.prototype.scanText=function(){for(var t=0,e=this.idx;(t=this.next())&&t!==c;);var i=this.src.slice(e,this.idx);this.pushToken(L.TextLiteral,i),this.idx--},I.prototype.scanTagOpen=function(){var t=this,e=0;for(this.scanPunctuator();;){if((e=t.next())<=0)break;if(t.isQuote(e))t.scanQuotedString();else if(!t.isBlank(e))if(t.isAlpha(e))t.scanAlpha();else{if(!t.isPunctuator(e)){t.idx--;break}if(e===p){t.scanTagClose();break}if(e===O&&"-"===t.src[t.idx+1]){t.scanComment(e);continue}if(e===m){t.scanEscapedAttribute();continue}t.scanPunctuator()}}},I.prototype.scanEscapedAttribute=function(){var t=this,e=0;this.scanPunctuator();var i=this.src[this.idx+1].charCodeAt(0);if(!this.isQuote(i)){for(var n=this.idx;;){if((e=t.next())<=0)break;if(t.isBlank(e))break;if(t.isTag(e))break;if(e===b&&">"===t.src[t.idx+1])break}var r=this.src.slice(n+1,this.idx);this.pushToken(L.StringLiteral,r)}},I.prototype.scanComment=function(t){var e=this;for(this.idx++;;){var i=t;if((t=e.next())<=0)break;if(i===O&&t===O)break}this.tokens.splice(this.tokens.length-2,2),this.idx++},I.prototype.scanTagClose=function(){this.scanPunctuator()},I.prototype.scanAlpha=function(){for(var t=this,e=0,i=this.idx;(e=this.next())&&(t.isAlpha(e)||t.isNumber(e)||e===O||e===A||e===y););var n=this.src.slice(i,this.idx);this.pushToken(L.Identifier,n),this.idx--},I.prototype.scanPunctuator=function(){var t=this.src[this.idx];this.pushToken(C[t],t)},I.prototype.scanQuotedString=function(){for(var t=this,e=0,i=this.idx;;){if((e=t.next())<=0)break;if(t.isQuote(e))break}var n=this.src.slice(i+1,this.idx);this.pushToken(L.StringLiteral,n)},I.prototype.pushToken=function(t,e){this.tokens.push({kind:t,value:e})},I.prototype.pushEOF=function(){var t="";this.pushToken(L.EOF,t)},I.prototype.next=function(){return++this.idx<this.length?this.src[this.idx].charCodeAt(0):0},I.prototype.isTag=function(t){return t===c||t===p},I.prototype.isPunctuator=function(t){return t===c||t===p||t===N||t===m||t===b||t===O},I.prototype.isNumber=function(t){return t>=f&&t<=l},I.prototype.isQuote=function(t){return t===d||t===x},I.prototype.isLineTerminator=function(t){return 10===t||13===t},I.prototype.isBlank=function(t){return 10===t||13===t||9===t||11===t||12===t||32===t||160===t},I.prototype.isAlpha=function(t){return t>=T&&t<=v||t>=k&&t<=E};var _=Object.freeze({parseRoot:r,parseNodeList:s,parseNode:o,parseNodeContent:u,parseClosingNode:a,parseAttributes:h}),D=function(){this.idx=0,this.limit=0,this.tokens=null,this.current=null};D.prototype.reset=function(t){this.idx=0,this.current=t[0],this.limit=t.length,this.tokens=t},D.prototype.parse=function(t){this.reset(t);var e=this.parseRoot();return e},D.prototype.eat=function(t){return!!this.peek(t)&&(this.next(),!0)},D.prototype.consume=function(){var t=this.current;return this.next(),t},D.prototype.peek=function(t){return this.current.kind===t},D.prototype.isEOF=function(){return this.current.kind===L.EOF},D.prototype.back=function(){return this.idx>=1&&(this.idx-=2,this.next(),!0)},D.prototype.subsequent=function(t){this.next();var e=this.peek(t);return this.back(),e},D.prototype.next=function(){return this.idx<this.limit&&(this.current=this.tokens[++this.idx],!0)},D.prototype.expect=function(t){this.peek(t)?this.next():this.throw("Expected "+i(t)+" but got "+i(this.current.kind),this.current)},D.prototype.throw=function(t,e){e.range;throw new Error(t)},n(D,_);var G=new I,P=new D,F=function(t){var e=G.lex(t),i=P.parse(e);return i};t.Lexer=I,t.Parser=D,t.parse=F,Object.defineProperty(t,"__esModule",{value:!0})});
